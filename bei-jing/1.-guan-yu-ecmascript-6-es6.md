# 1. 关于 ECMAScript 6 （ES6）

花了很长时间，JavaScript 的下一个版本 ES6 终于成为现实：

* 它于 2015 年 6 月 17 日成为标准
* 大多数特性已经广泛可用（见 kangax 的 ES6 兼容表）
* 转换器（比如 Babel）可以把 ES6 转化为 ES5

下面的部分解释了 ES6 的世界中重要的概念。

### 1.1 TC39（Ecma 技术委员会 39）

TC39（Ecma 技术委员会 39）是推动 JavaScript 的委员会。它的成员都是公司（其主要是浏览器供应商）。TC39 会定期开会，由成员派出的代表和受邀专家参加。会议纪要可在线获取，这样能够对 TC39 的运作方式有一个很好的了解。

### 1.2 ECMAScript 6 是如何设计的

ECMAScript 6 设计过程以功能提案为中心。通常由开发者社区的建议引发。为了避免由委员会参与设计，提案由 champions （1-2 名委员会代表）维护。

在标准化之前，一个提案要经过以下步骤：

* 草案（非正式说法：strawman 提案）：对提议特性的第一次描述
* 提案：如果 TC39 同意某一个功能很重要，它就会提升为官方的提案状态。但这并不能保证它会成为标准，但是机会是大大增加的。ES6 提案的截止日期是 2011 年 5 月。在这之后不考虑重大的新提案。
* 实现：提案的特性必须实现。理想情况下在两个 JavaScript 引擎中。社区的实现和反馈会随着提案的发展形成。
* 标准化：如果提案持续验证并且被 TC39 接受，最终它会被包含在 ECMAScript 标准的一个版本中。这个时候，就是一个标准的特性。

【本节来源：David Herman 的 The Harmony Process。】

#### 1.2.1 ES6之后的设计过程

从 ECMAScript 2016 （ES7）开始，TC39 将定时发布。每年都会发布一个 ECMAScript 的新版本，届时所有特性都已经准备好了。意味着从现在开始，ECMAScript 版本将进行相对较小的升级。有关新流程的更多信息，包括已完成和即将推出的特性提案，请参阅 [GitHub ecma262](https://github.com/tc39/ecma262)。

### 1.3 JavaScript vs ECMAScript

JavaScript 是大家对这个语言的称呼，但是这个名字已经被注册了（Oracle，从 Sun 公司继承了该商标）。所以，JavaScript 的官方称呼是 ECMAScript。 该名字来源于管理语言标准的组织 Ecma。自 ECMAScript 成立以来，组织名称已经从首字母 ECMA 变为专有名 Ecma。

JavaScript 的版本是由带有语言官方名的规范定义。因此，JavaScript 的第一个标准版本是 ECMAScript 1，是 ECMAScript Language Specification, Edition 1 的缩写。ECMAScript x 通常缩写为 ESx。&#x20;

### 1.4 升级至 ES6

web 的利益相关：

* JavaScript 引擎的实现者
* web 应用的开发者
* 用户

这些团体相互制约的影响很小。这也是为什么升级 web 语言如此具有挑战性。

一方面来说，升级引擎很有挑战，因为需要面对 web 上各种代码，其中一些非常老旧。你可能希望引擎的升级是自动化的，并不会影响到用户。因此，ES6 是 ES5 的超集，没有移除什么。ES6 的升级没有引入版本或者模式。甚至（通过模块）让严格模式成为了实际的默认模式，也没有和普通模式有太多的割裂。它用了一种叫 One JavaScript 的方法，在单独的一章中有描述。

另一方面，升级代码也具有挑战性，因为代码必须在你目标用户使用的所有 JavaScript 引擎上运行。因此，如果想在代码中使用 ES6，你只有两种选择：你可以等到目标用户不再有人使用非 ES6 引擎。这需要数年时间；主流用户会选择在 2015 年 6 月，ES6 成为标准的时候考虑 ES5。然而 ES5 在 2009 年 12 月就已经标准化了！或者你现在就可以把 ES6 编译为 ES5 就开始用。至于怎么做可以参阅 [Setting up ES6](https://leanpub.com/setting-up-es6) 获得更多信息，可以免费在线阅读。

在设计 ES6 中目标和要求之间的冲突

* 目标是修复 JavaScript 的缺陷并增加新特性
* 要求是在不破坏现有代码、不改变语言轻量级性质的情况下完成

### 1.5 ES6 目标

Harmony/ES6 的原始项目页面提到了几个目标。在下面的小节中，瞅瞅其中几个。

#### 1.5.1 目标：成为更好的语言

目标是：书写方面成为更好的语言：

i. 复杂应用；

ii. 成为这些应用共享的库（可能包括 DOM）

iii. 针对新版本的代码生成器

子目标（i）承认用 JavaScript 编写的应用已经变得庞大。ES6 一个关键特性就是用内置模块填补这个目标。

模块同样是目标（ii）的一个回答。顺便说一句，众所周知，DOM 很难在 JavaScript 中实现。ES6 Proxies 可以有所帮助。

添加这些特性主要是编译 JavaScript 更容易。比如下面两个例子：

* `Math.fround()` - 将数字四舍五入为 32 位浮点数
* `Math.imul()` - 将两个 32 位整数相乘

它们都很有用，比如：通过 [Emscripten](https://github.com/emscripten-core/emscripten) 将 C/C++ 编译成 JavaScript 的时候。

#### 1.5.2 目标：改进交互操作

目标是：改进交互操作，尽可能采用实际标准。

比如：

* Classes：基于构造函数当前的使用方式。
* Modules：从 CommonJS 模块格式中汲取设计思想。
* Arrow function：从 CoffeeScript 借鉴语法
* Named function parameters：其实对命名参数没有内置的支持。相反，现有通过对象字面量命名参数的做法是通过参数定义的解构。

#### 1.5.3 目标：版本控制

目标是：让版本控制尽可能简单和线性。

正如之前提到的，ES6 践行 One JavaScript 避免 versioning。在 ES6 代码库中，一切均是 ES6，没有特定于 ES5 的部分。

### 1.6 ES6 特性大类

ES6 规范的介绍列出了所有的新特性：

> 有关 【ECMAScript 6】的一些增强包括模块、类的声明、块级作用域、迭代器和生成器、异步编程的 promise，解构模式和适当的词尾调用。内置的 ECMAScript 库已经扩展支持额外的数据结构，包括二进制数值的映射、集合和数组，同时对字符串和正则表达式中的 Unicode 补充字符提供额外的支持。内置的可以通过子类进行扩展。

特性可以分为三大类：

* 为已存在的特性提供更好的语法（比如：用到库）。举例：
  * Classes
  * Modules
* 标准库中的新功能。举例：
  * 字符串和数组的新方法
  * Promises
  * Maps，Sets
* 全新的功能。举例：
  * Generators
  * Proxies
  * WeakMaps

### 1.7 ECMAScript 简史

本节描述了通往 ECMAScript6 路上发生的事情。

#### 1.7.1 早年：ECMAScript 1-3

* **ECMAScript 1（1997 年 6 月）**是 JavaScript 标准的第一个版本。
* **ECMAScript 2 （1998 年 6 月）**包含了一些小改动，以使规范与 JavaScript 单独的ISO标准保持同步。
* ECMAScript 3 （1999 年 12 月）引入了很多当下流行的特性，就像介绍 ES6 规范中介绍的那样：... 正则表达式，更好的字符串处理、新的控制语句、try/catch 异常处理、更严格的错误定义，数字型输出的格式化和其他增强功能。

#### 1.7.2 ECMAScript 4 （2008 年 7 月弃用）

ES4 的工作在 1999 年 ES3 发布之后开始。2003 年，发布了一份中期报告，此后 ES4 的工作暂停。中期报告中描述的语言子集由 Adobe （在 ActionScript）和 Microsoft（在 JScript.NET）中实现。

在 2005 年 2 月，Jesse James Garrett 发现，在 JavaScript 实现动态的前端应用中，技术的组合变得非常流行。他把这些技术称为 Ajax。Ajax 开启了一类全新的 web 应用，并激发了人们对 JavaScript 的兴趣。

这可能促使 TC39 在 2005 年秋季恢复了 ES4 的工作。它们基于 ES3、ES4的临时报告以及 ActionScript 和 JScript.NET 的经验来构建 ES4。

那会儿有两个小组致力于未来 ECMAScript 的版本：

* ECMAScript 4 由 Adbobe，Mozilla，Opera 和 Google 设计，是一次大规模升级。其计划的特性包括：
  * 大型编程（类，接口，命名空间，包，程序单元，可选的类型注释以及可选的静态类型检查和验证）
  * 升级编程和脚本（结构类型、duck typing、类型定义和多方法）
  * 构造数据结构（参数化类型、getters 和 setters 和 元方法）
  * Control abstractions (proper tail calls, iterators, and generators)
  * Introspection (type meta-objects and stack marks)
* ECMAScript 3.1 由 Microsoft 和 Yahoo 设计。它被当成 ES4 的一个子集和 ECMAScript 3 的一个增量升级，其中修复了漏洞，新增了一些小特性。ECMAScript 3.1 最终变成了 ECMAScript 5。

这两个小组在 JavaScript 的未来上存在分歧，这加剧了它们之间紧张的关系。

{% hint style="info" %}
本节来源：

* “[Proposed ECMAScript 4th Edition – Language Overview](http://www.ecmascript.org/es4/spec/overview.pdf)”. 2007-10-23
* “[ECMAScript Harmony](http://ejohn.org/blog/ecmascript-harmony/)” by John Resig. 2008-08-13
{% endhint %}

#### 1.7.3 ECMAScript Harmony

2008 年 7 月底，在奥斯陆召开了一次 TC39 大会，Brendan Eich 对会议结果的描述如下：

众所周知，JavaScript 标准机构 Ecma TC39 已经分裂了一年多，一些成员支持 ES4... 其他的提倡 ES3.1... 现在，我很高兴的宣布，分裂就此结束。

会议达成了四点协议：

1. 开发 ECMAScript （将会变成 ECMAScript 5）的增量更新
2. 开发一个主要的新版本，比 ECMAScript 4 更平顺 ，但是比 ECMAScript 3 之后的版本范围更大。
3. ECMAScript 4 的一些特性会被删除：包、命名空间、early binding
4. 其他观点与 TC39 达成共识。

ECMAScript 的下一个版本是：

* ECMAScript 5 （2009 年 12 月）。这是当今大多数浏览器支持的 ECMAScript 版本。通过严格模式，给标准库带来了多项增强并更新了语言语义。
* ECMAScript 5.1 （2011 年 6 月）。ES5 是作为 ISO 标准提交的。在此过程中进行了一些小的修正。ES5.1 包含了这些修正。它和 ISO/IEC 16262:2011 有相同的文本。
* ECMAScript 6 （2015 年 6 月）。这个版本经历了多次更名：
  * ECMAScript Harmony：继 ECMAScript 5 之后 JavaScript 改进版的初始代码。
  * ECMAScript.next：很明显，Harmony 的计划对于单个版本来说过于雄心勃勃，因此它的特性分了两组：第一组具有高优先级，将成为 ES5 的下一个版本。为了避免过早提交版本号，该版本被称为 ECMAScript.next，后来在 ES4 中被证明是有问题的。第二组是在 ECMAScript.next 之后才有时间。
  * ECMAScript 6：随着 ECMAScript.next 逐渐成熟，它的代号被取消了，大家开始称呼为 ECMAScript 6。
  * ECMAScript 2015：2014 年底，鉴于即将发布的年度规范，TC39 决定将 ECMAScript 6 正式更名为 ECMAScript 2015。考虑到 ECMAScript 6 已经在大众心中根深蒂固，TC39 的想法未免太迟了，我希望大家都能继续提及该版本。
* ECMAScript 2016 之前称为 ECMAScript 7。从 ES2016 开始，每年都会发布更小的版本。

